# -*- coding: utf-8 -*-
"""
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•   â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â•     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•   â•šâ•â•   â•šâ•â•â•â•â•â•â•â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                Lost Ark wait notifier api
                develop by woosik yoon (yoonwoosik12@naver.com)
                [suitee.me]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""

from flask import Flask, request, jsonify
from dbtools import *
from datetime import datetime
from crawler import *

app = Flask(__name__)

@app.route('/keyboard')
def Keyboard():
    data_send = {
        "type": "buttons",
        "buttons": ["ëŒ€ê¸°ì—´", "ë„ì›€ë§"]
    }
    return jsonify(data_send)


@app.route('/message', methods=['POST'])
def Message():
    data_receive = request.get_json()
    content = data_receive['content']
    if content == u"ëŒ€ê¸°ì—´":
        db = DbTools(select_only=True)
        data = db.get_data()
        now = datetime.now()
        text = "ğŸ¤ï¸ë¡œìŠ¤íŠ¸ì•„í¬ ëŒ€ê¸°ì—´ ì•Œë¦¼ë´‡\n"
        text += "â•â•â•â•â•â•â•â•â•â•â•\n"
        text += f"{now.hour}ì‹œ {now.minute}ë¶„ {now.second}ì´ˆ ê¸°ì¤€\n\n"

        for item in data:
            queue = item[1]
            if item[1] == -1:
                queue = 'ì§€ì›ì˜ˆì •'

            text += f"{item[0]} : {queue}\n"
        text += f"\në°ì´í„° ì œê³µ :\nrubystarashe.github.io/lostark\n"
        db.close()

        data_send = {
            "message": {
                "text": text
            }
        }
    elif content == u"ë„ì›€ë§":
        data_send = {
            "message": {
                "text": "ë„ì›€ë§ ëª©ë¡\n\nâ•â•â•â•â•â•â•â•â•â•â•\n1. ëŒ€ê¸°ì—´\n\n2. ë„ì›€ë§"
            }
        }
    else:
        data_send = {
            "message": {
                "text": "ëª…ë ¹ì–´ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.\n1. ëŒ€ê¸°ì—´\n\n2. ë„ì›€ë§"
            }
        }

    data_send["message"].update({'message_button': {'label': 'ê°œë°œì ìœ¤ì˜´ë¯€ ë¸”ë¡œê·¸', 'url': 'http://suitee.me'}})
    data_send["keyboard"] = {"type": "buttons", "buttons": ["ëŒ€ê¸°ì—´", "ë„ì›€ë§"]}
    return jsonify(data_send)


if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8080)